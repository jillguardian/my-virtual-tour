<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="default">
<head>
    <title th:text="${location?.id}? #{location.edit} : #{location.add}">Location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css"
          th:href="@{/webjars/leaflet/0.7.3/leaflet.css}" />
    <style>
        .form-group.location-image > .thumbnail {
            margin-bottom: 0;
        }
        .form-group.location-image > .thumbnail > img {
            object-fit: cover;
            height: 250px;
        }
        .form-group.location-image > input[type=file] {
            display: none;
        }
    </style>
</head>
<body>
<h1 layout:fragment="content-heading" th:text="${location?.id}? #{location.edit} : #{location.add}">
    Location
</h1>
<ol th:fragment="breadcrumb" class="breadcrumb">
    <li>
        <a th:href="@{/}">
            <i class="fa fa-dashboard"></i> <span th:text="#{dashboard}" th:remove="tag">Dashboard</span>
        </a>
    </li>
    <li>
        <a th:href="@{/location}">
            <i class="fa fa-map-o"></i> <span th:text="#{locations}" th:remove="tag">Locations</span>
        </a>
    </li>
    <th:block th:with="text=#{new}">
        <li class="active">
            <i class="fa fa-map-marker"></i>
            <span th:text="${location.id != null ? location.id : text}" th:remove="tag">#</span>
        </li>
    </th:block>
</ol>
<div layout:fragment="content-body">
    <form th:if="${location}"
          th:action="@{/location/save}"
          th:object="${location}"
          method="POST"
          role="form"
          enctype="multipart/form-data">
        <div class="row" th:if="${#fields.hasGlobalErrors()}">
            <div class="col-md-12">
                <div th:with="text=#{error.message}, errors=${#fields.globalErrors()}">
                    <div th:replace="fragment/list-item-alert :: alert (type='danger', message=${text}, items=${errors}, classes='', style='')">Errors</div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="box-header with-border"></div>

                    <div class="box-body">
                        <div class="row">
                            <div class="col-sm-12 col-md-6">
                                <div class="form-group" th:classappend="${#fields.hasErrors('id')} ? has-error : ''" th:hidden="true">
                                    <input type="hidden" th:field="*{id}" readonly="readonly" class="form-control" id="id" th:placeholder="#{id.placeholder}" placeholder="#"/>
                                </div>
                                <div class="form-group" th:classappend="${#fields.hasErrors('name')} ? has-error : ''">
                                    <label for="name" th:text="#{name}">Name</label>
                                    <input type="text" th:field="*{name}" class="form-control" id="name" th:placeholder="#{location.name.placeholder}" placeholder="Tarlac State University"/>
                                    <p class="help-block" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></p>
                                </div>
                                <div class="row">
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('website')} ? has-error : ''">
                                        <label for="website" th:text="#{website}">Website</label>
                                        <input type="url" th:field="*{website}" class="form-control" id="website" th:placeholder="#{location.website.placeholder}" placeholder="http://www.tsu.edu.ph"/>
                                    </div>
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('contactNumber')} ? has-error : ''">
                                        <label for="contact" th:text="#{contact-information}">Contact Information</label>
                                        <input type="text" th:field="*{contactNumber}" class="form-control" id="contact" th:placeholder="#{location.contact.placeholder}" placeholder="(045) 982 0110"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-xs-6 location-image" th:classappend="${#fields.hasErrors('coverImage1')} ? has-error : ''">
                                        <label for="primary-image-one" th:text="#{location.image.primary(1)}">Primary Image 1</label>
                                        <div class="thumbnail">
                                            <img id="primary-image-one-preview" src="http://via.placeholder.com/350x250?text=X" th:src="${location?.coverImage1?.uri ?: 'http://via.placeholder.com/350x250?text=X'}" />
                                        </div>
                                        <input type="file" th:field="*{coverImage1.file}" id="primary-image-one" accept="image/*" />
                                        <input type="hidden" th:field="*{coverImage1.id}" />
                                    </div>
                                    <div class="form-group col-xs-6 location-image" th:classappend="${#fields.hasErrors('coverImage2')} ? has-error : ''">
                                        <label for="primary-image-two" th:text="#{location.image.primary(2)}">Primary Image 2</label>
                                        <div class="thumbnail">
                                            <img id="primary-image-two-preview" src="http://via.placeholder.com/350x250?text=X" th:src="${location?.coverImage2?.uri ?: 'http://via.placeholder.com/350x250?text=X'}" />
                                        </div>
                                        <input type="file" th:field="*{coverImage2.file}" id="primary-image-two" accept="image/*" />
                                        <input type="hidden" th:field="*{coverImage2.id}" />
                                    </div>
                                </div>
                                <div class="form-group" th:if="${location?.id}">
                                    <a th:href="@{/location/} + ${location.id} + @{/image/new}"
                                       class="btn btn-default btn-block">
                                        <i class="fa fa-image"></i>
                                        <span th:text="#{image.add}" th:remove="tag">Add New Image</span>
                                    </a>
                                    <a th:href="@{/location/} + ${location.id} + @{/image}"
                                       class="btn btn-default btn-block">
                                        <i class="fa fa-image"></i>
                                        <span th:text="#{images.view}" th:remove="tag">View Images</span>
                                    </a>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-6">
                                <div class="form-group" th:classappend="${#fields.hasErrors('addressLine1')} ? has-error : ''">
                                    <label for="address-line-one" th:text="#{address-line(1)}">Address Line 1</label>
                                    <input type="text" th:field="*{addressLine1}" class="form-control" id="address-line-one" th:placeholder="#{location.address-line-one.placeholder}" placeholder="Romulo Blvd., San Vicente"/>
                                </div>
                                <div class="form-group" th:classappend="${#fields.hasErrors('addressLine2')} ? has-error : ''">
                                    <label for="address-line-two" th:text="#{address-line(2)}">Address Line 2</label>
                                    <input type="text" th:field="*{addressLine2}" class="form-control" id="address-line-two" th:placeholder="#{location.address-line-two.placeholder}" placeholder=""/>
                                </div>
                                <div class="row">
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('city')} ? has-error : ''">
                                        <label for="city" th:text="#{city}">City</label>
                                        <input type="text" th:field="*{city}" class="form-control" id="city" th:placeholder="#{location.city.placeholder}" placeholder="Tarlac City"/>
                                        <p class="help-block" th:if="${#fields.hasErrors('city')}" th:errors="*{city}"></p>
                                    </div>
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('zipCode')} ? has-error : ''">
                                        <label for="zip" th:text="#{zip-code}">Zip Code</label>
                                        <input type="text" th:field="*{zipCode}" class="form-control" id="zip" th:placeholder="#{location.zip-code.placeholder}" placeholder="2003" />
                                        <p class="help-block" th:if="${#fields.hasErrors('zipCode')}" th:errors="*{zipCode}"></p>
                                    </div>
                                </div>
                                <div id="map" style="width: 100%; height: 350px; margin-bottom: 15px;"></div>
                                <div class="row">
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('longitude')} ? has-error : ''">
                                        <label for="longitude" th:value="#{longitude}">Longitude</label>
                                        <input type="number"
                                               step="any"
                                               th:field="*{longitude}"
                                               class="form-control"
                                               id="longitude"
                                               th:placeholder="#{location.geometry.point.longitude.placeholder}"
                                               placeholder="Longitude" />
                                        <p class="help-block" th:if="${#fields.hasErrors('longitude')}" th:errors="*{longitude}"></p>
                                    </div>
                                    <div class="form-group col-xs-12 col-md-6" th:classappend="${#fields.hasErrors('latitude')} ? has-error : ''">
                                        <label for="latitude" th:value="#{latitude}">Latitude</label>
                                        <input type="number"
                                               step="any"
                                               th:field="*{latitude}"
                                               class="form-control"
                                               id="latitude"
                                               th:placeholder="#{location.geometry.point.latitude.placeholder}"
                                               placeholder="Latitude" />
                                        <p class="help-block" th:if="${#fields.hasErrors('latitude')}" th:errors="*{latitude}"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-footer">
                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button type="submit" class="btn btn-primary btn-block" th:value="#{submit}">Submit</button>
                            </div>
                            <div class="btn-group"
                                 role="group"
                                 th:if="${location?.id}">
                                <a id="delete-link" class="btn btn-danger btn-block" th:value="#{delete}">Delete</a>
                            </div>
                            <div class="btn-group" role="group">
                                <button id="reset" type="reset" class="btn btn-default btn-block" th:value="#{reset}">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <form action="/location/delete"
          th:action="@{/location/delete}"
          method="POST" th:if="${location?.id}"
          th:hidden="true">
        <div class="form-group col-xs-12">
            <input name="id" type="hidden" th:value="${location.id}"/>
        </div>
        <div class="form-group col-xs-12">
            <button type="submit" class="btn btn-danger btn-block" th:value="#{delete}">Delete</button>
        </div>
    </form>
</div>
<th:block layout:fragment="scripts">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"
            th:src="@{/webjars/leaflet/0.7.3/leaflet.js}">
    </script>
    <script type="text/javascript" th:inline="javascript">
        var map = L.map('map').setView([15.4601, 120.6211], 13);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var marker = L.marker([15.4601, 120.6211],{draggable: true}).addTo(map);
        marker.on('dragend', function(event) {
            var marker = event.target;  // you could also simply access the marker through the closure
            var result = marker.getLatLng();  // but using the passed event is cleaner
            var lat = result.lat;
            var lng = result.lng;
            console.log('Latitude :'+lat+' Longitude : '+ lng);
            $('#latitude').val(lat);
            $('#longitude').val(lng);
        });

        /*<![CDATA[*/
        $('document').ready(function() {
            $('.form-group.location-image > .thumbnail').click(function(e) {
                $(this).siblings('input[type=file]').click();
            });
            $('.form-group.location-image > input[type=file]').change(function() {
                var url = window.URL.createObjectURL($(this)[0].files[0]);
                $(this).siblings('.thumbnail').children('img:first').attr('src', url);
            });
            $('#reset').click(function(e) {
                $('#primary-image-one-preview').attr('src', /*[[${location?.coverImage1?.uri ?: 'http://via.placeholder.com/350x250?text=X'}]]*/ '');
                $('#primary-image-two-preview').attr('src', /*[[${location?.coverImage2?.uri ?: 'http://via.placeholder.com/350x250?text=X'}]]*/ '');
            });
        });
        /*]]>*/
    </script>
</th:block>
</body>
</html>